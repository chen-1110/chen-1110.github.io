---
layout: post
categories: 整理记录
author: chen
title: RocketMQ面试
---
#### 1.消息队列作用和缺陷

异步

解耦：定义好交互，各自实现逻辑，不互相影响

削峰

缺陷：需要保证消息高可用，消息可能重复，需要处理分布式事务

#### 2.RocketMQ架构

![img](https://raw.githubusercontent.com/chen-1110/image/main/16ef386fa3be1e53.jpg)

nameServer： 类似注册中心

producer

consumer

broker： 高可用存储队列

#### 3.消息生命周期

- 初始化：消息被生产者构建并完成初始化，待发送到服务端的状态。
- 待消费：消息被发送到服务端，对消费者可见，等待消费者消费的状态。
- 消费中：消息被消费者获取，并按照消费者本地的业务逻辑进行处理的过程。 此时服务端会等待消费者完成消费并提交消费结果，如果一定时间后没有收到消费者的响应，RocketMQ 会对消息进行重试处理。
- 消费提交：消费者完成消费处理，并向服务端提交消费结果，服务端标记当前消息已经被处理（包括消费成功和失败）。RocketMQ 默认支持保留所有消息，此时消息数据并不会立即被删除，只是逻辑标记已消费。消息在保存时间到期或存储空间不足被删除前，消费者仍然可以回溯消息重新消费。
- 消息删除：RocketMQ 按照消息保存机制滚动清理最早的消息数据，将消息从物理文件中删除。

