---
layout: post
categories: 整理记录
author: chen
title: AQS简单使用
---
## 一、是什么

aqs是java多种并发工具类的抽象类，其定义了底层数据结构及并发操作流程，但是留下了入队，出队，共享/独占等钩子函数，从而让不同的并发工具类有不同的实现。

其主要的成员变量有

1.state int状态，用来定义锁是否可以获取，0代表锁占用，1代表可以获取，此外可以设置大于1从而实现可重入/多线程共享的效果

2.node列表，将阻塞的线程放在node列表，可利用其fifo特性实现公平锁

## 二、几种典型实现

#### reentrantLock

state为1，入队-1，出队+1

#### semaphore

state自己设置为x，入队-1，出队+1，到达0即到达上限，从而控制x个线程同时运行

#### CountDownLatch

state自己设置为x，入队-1，出队+1，可以将主线程await，从而实现前x个线程全部完成后，主线程再完成逻辑。

可以被completableFuture替代

其与CyclicBarrier最大区别是，栅栏可以循环用，前者只能用一次

